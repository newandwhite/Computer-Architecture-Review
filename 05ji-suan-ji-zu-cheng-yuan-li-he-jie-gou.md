# 05 计算机组成原理和结构
### 计算机组成原理和结构
* 冯诺依曼结构的五大组成部件：存储器、运算器、控制器、输入设备和输出设备
* 物理实现时分为**CPU、存储器、IO设备**三大部分

### 计算机硬件结构的演进
现代计算机系统硬件结构主要包括：
* 中央处理器CPU
    * 控制器和运算器
* 图形处理器GPU
* 北桥：离CPU最近的芯片
    * 显卡、内存与CPU之间的数据交换
* 南桥
    * 硬盘、键盘以及各种对带宽要求较低的IO接口与内存、CPU之间的数据交换

#### 四片结构
* CPU-北桥-南桥

![](/pic/四片.jpg)

#### 三片结构
* CPU-北桥-南桥：四片结构的GPU被集成到北桥（集成显卡）

![](/pic/三片1.jpg)
* CPU-弱北桥-南桥：对计算机性能影响显著的内存控制器开始被集成到CPU芯片中，北桥功能被弱化，主要集成了CPU、显示接口、高速IO接口

![](/pic/三片2.jpg)
#### 两片结构
* CPU-南桥：GPU被集成到CPU中，北桥和南桥合二为一（主流商用中高端处理器，相对灵活）

![](/pic/两片.jpg)
#### 单片结构
* SoC（片上系统）单片结构：在单个芯片上集成处理器、内存控制器、GPU及硬盘、USB、网络等IO接口（如手机等移动设备）

![](/pic/单片.jpg)
### 处理器和IO间通信
* IO寄存器寻址方式
    * 特殊IO指令：使用专用指令来执行IO操作，IO地址空间可以和内存地址空间重叠，但实际指向不同位置
        * 处理器状态限制访问空间
    * 地址空间映射：把IO寄存器的地址映射到内存地址空间中，这些寄存器和内存存储单元被统一编址，读写IO地址和读写内存地址使用相同的指令来执行
        * 操作系统禁止应用程序执行IO指令阻止应用程序直接访问IO设备
* CPU与IO间（两个都是master）的同步：CPU通过向IO寄存器写入命令字来控制IO设备
    * 查询方式：处理器向IO设备发出访问请求后，需要不断读取IO设备的状态寄存器（轮询）
        * 浪费指令周期
        * 浪费性能
    * 中断方式：不需要轮询状态寄存器的值，而是在等待设备完成某个操作时去执行其他进程
        * PIC：可编程控制器
* CPU与IO间的通信：
    * PIO方式：要用通用寄存器进行中转
        * 当需要从存储器中搬运数据到IO设备时，处理器首先从存储器中读数据到通用寄存器中，再从通用寄存器写数据到IO设备中
        * 当需要从IO设备搬运数据到存储器中时，处理器要先从IO设备中读数据到通用寄存器，再从通用寄存器写入内存
    * DMA方式：直接存储器访问
        * 在储器和外设之间开辟直接的数据传送通道，数据传送由专门的硬件（DMA控制器）来控制
            * 处理器为DMA请求预先分配一段地址空间
            * 处理器设置DMA控制器参数
            * DMA控制器进行数据传输
            * DMA控制器向处理器发出一个中断，通知处理器数据传送的结果
            * 处理器完成本次DMA请求，可以开始新的DMA请求
    
> * 两种方式处理流程一致
> * IO访问比内存慢很多

### 计算机系统主要组成部件
* 运算器
* 控制器
    * 转移预测技术
    * 乱序执行技术
    * 超标量技术：允许指令流水线每一阶段同时处理多条指令
* 存储器
    * 存储介质
        * 磁性存储介质（非易失）
        * 闪存（非易失）
        * DRAM：动态随机访问存储器（易失）
            * DRAM的单元结构和读写过程：
        * SRAM：静态随机访问存储器（易失）
    * 存储层次：存储层次的有效性，依赖于程序访存局部性原理
        * 寄存器：多端口寄存器堆
        * 高速缓存（Cache）：SRAM构建片上高速缓存
        * 内存：DRAM构建
            * SDRAM：同步动态随机存储器。提高内存接口效率：
                * 提高行缓冲局部性RBL：
                    * 关行策略与开行策略：$$t_{开行不命中} > t_{关行} > t_{开行命中}$$
                * 提高Bank级并行度BLP：
                    * SDRAM芯片包含的多个Bank是相互独立的，它们可以同时执行不同的操作
        * 大容量存储器：磁盘或闪存构建
* 输入/输出设备
    * GPU
    * 硬盘
    * 闪存